---
title: "3-exploration"
output:
  pdf_document: default
  html_notebook: default
---

```{r}
library(kableExtra)
library(tidyverse)

# read in the cleaned data
vh_train = read_tsv("../data/clean/vh_train.tsv")

cols = c("region", "hispanic", "race", "education_level", "marital_status", 
         "birth_gender", "described_gender", "sexual_orientation", "had_covid", 
         "recent_work_loss", "employment", "child_tax_credit", 
         "difficulty_with_expenses", "work_onsite", "work_from_home", 
         "in_store_shopping", "eating_indoors_restaurants", 
         "in_person_medical_appointments", "in_home_housekeeping", 
         "household_food_sufficiency", "household_free_food", "snap_receipt",
         "anxious", "worry", "interest", "depressed", 
         "prescription_mental_health", "mental_health_services", 
         "mental_health_not_get", "private_health_insurance", 
         "public_health_insurance", "telehealth_personal", "telehealth_child",
         "child_missed_checkups", "seeing_limitations", "hearing_limitations", 
         "remembering_limitations", "mobility_limitations", 
         "housing_owned_rented", "building_type", "rent_caught_up", 
         "mortgage_caught_up", "housing_pay_confidence", 
         "rent_assistance_apply", "eviction_likelihood", "foreclose_likelihood",
         "energy_pay_trouble", "housing_unsafe_temp", "income", "kids", 
         "active_duty", "essential_worker", "pandemic_child_impact", 
         "summer_educational_catch_up", "post_sec_edu_plan_changes", 
         "children_public_school", "children_private_school", 
         "children_homeschool", "post_secondary_classes", "vaccine_hesitancy"
         )
  
vh_train <-
  vh_train %>%
       mutate_each_(funs(factor(.)), cols)

# breakdown of vaccination intention responses in this data
intention_breakdown_table <-
  vh_train %>%
  count(vaccine_hesitancy) %>%
  pivot_wider(names_from = vaccine_hesitancy, values_from = n) %>%
  summarise(No = `0`, Yes = `1`) %>%
  pivot_longer(c(`Yes`, `No`), 
               names_to = "response", values_to = "count") %>%
  write_tsv("../results/response-breakdown.tsv")

positions <- c("Yes", "No")

p <- intention_breakdown_table %>%
  ggplot(aes(x = response, y = count)) + 
  geom_bar(stat='identity') +
  ggtitle("Hesitancy Breakdown") + 
  scale_x_discrete(limits = positions) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

# save the histogram
ggsave(filename = "../results/response-histogram.png", 
       plot = p, 
       device = "png", 
       width = 5, 
       height = 3)
```


